{
  "packages": [
    "yq@latest",
    "git@latest"
  ],
  "shell": {
    "scripts": {
      "deploy": [
        "echo 'Authorizing git...'",
        "git config --global user.email \"$GH_USER_EMAIL\"",
        "git config --global user.name \"$GH_USER\"",
        "echo 'Updating image tag on GitOps repo...'",
        "cd apps/helm/notes-app",
        "yq -y -i '.environments[0].image.tag = env(CONTAINER_TAG) | (. * {\"tag\": \"\"} | select(tag == \"!!merge\"))' values.yaml",
        "if [[ -z $(git status -s) ]]; then echo \"The container tags have already been updated to: $CONTAINER_TAG. Deployment skipped...\" && exit 0; fi",
        "echo 'Committing changes...'",
        "git add .",
        "git commit -m \"$GIT_MESSAGE\"",
        "git push"
      ]
    }
  }
}
