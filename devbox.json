{
  "packages": [
    "yq-go@latest",
    "git@latest",
    "chart-testing@latest",
    "helm@latest",
    "kubectl@latest",
    "yamllint@latest",
    "go@latest",
    "terraform@latest"
  ],
  "shell": {
    "scripts": {
      "deploy": [
        "for var in GH_USER_EMAIL GH_USER ENV_NUM CONTAINER_TAG GIT_MESSAGE; do eval \"value=\\$$var\"; [ -z \"$value\" ] && { echo \"Error: $var is not set.\"; exit 1; }; done",
        "echo '✅ Env vars confirmed'",
        "yq -i e '.environments[env(ENV_NUM)].tag = env(CONTAINER_TAG) | (... | select(tag == \"!!merge\")) tag = \"\"' apps/helm/notes-app/values.yaml",
        "if [[ -z $(git status -s) ]]; then echo \"The container tags have already been updated to: $CONTAINER_TAG. Deployment skipped...\" && exit 0; fi",
        "echo '✅ Image tag updated'",
        "git config --global user.email \"$GH_USER_EMAIL\"",
        "git config --global user.name \"$GH_USER\"",
        "git add .",
        "git commit -m \"$GIT_MESSAGE\"",
        "git push",
        "echo '✅ Changes deployed'"
      ],
      "test:unit": [
        "echo 'Running unit tests...'",
        "ct lint --config .tests/ct-config.yaml --all"
      ],
      "test:integration": [
        "echo 'Running integration tests...'",
        "cd .tests/integration && go test -v -timeout 30m"
      ],
      "test:terratests": [
        "echo 'Running terratests...'",
        "cd .tests/terratests && go test -v -timeout 30m"
      ],
      "test:all": [
        "devbox run test:unit",
        "devbox run test:integration",
        "devbox run test:terratests"
      ]
    }
  }
}
